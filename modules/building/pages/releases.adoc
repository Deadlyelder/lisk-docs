= Releasing new documentation versions
:imagesdir: ../assets/images

:url_github_sdk_examples: https://github.com/LiskHQ/lisk-sdk-examples/tree/development
:url_staging: https://liskhq.github.io/lisk-docs

:url_contributing: contributing.adoc
:url_search: search.adoc
:url_styleguide: styleguide:index.adoc

The steps that are necessary and/or recommended for updating the documentation to a new version are explained on this page.

== Explaining by example: Releasing the SDK 4.0.0 docs

This guide uses the release of the SDK 4.0.0 docs as an example to illustrate the general steps that need to be done for a new release on a practical level.
Lisk SDK version 3.0.2 is the previous latest version in this example.

NOTE: The steps explained here are not specific for the Lisk SDK docs and do also apply for other documentation components like `core`, `protocol` and `service`.

:sectnums:
:sectnumlevels: 2
[[preparing]]
== Preparing the new docs

=== Learning

Examples how to get knowledge about the new release:

* Get onboarded internally (if provided)
** via internal changelog
** via STMs
* Get onboarded on GitHub in the project description: https://github.com/LiskHQ/lisk-sdk/projects
** Read all LIPs carefully, which are linked in the project description
+
image:project-changelog.png[]
* Check the corresponding GitHub project: https://github.com/LiskHQ/lisk-sdk/projects/76
** Look at the epic issues
** Go down to the child issues and PRs of certain epics of needed

=== Setting up a new project in the lisk-docs repository

. Create a new project on lisk-docs for the new version: https://github.com/LiskHQ/lisk-docs/projects
* title: "Lisk SDK 4.0.0"
* description: follow the existing examples
. xref:{url_contributing}[Create issues] for all upcoming content changes in the docs and add them to the project.
New issues can still be added later, if necessary.

==== Major release

If a major version is released, a new content branch needs to be created for it.

Create a new branch `docs-sdk-3.0.2`, on the base of `docs-sdk`.
Like the version number indicates, this branch will store the docs that become outdated with the new release.


.On branch `docs-sdk`
[source,bash]
----
git checkout docs-sdk
git pull origin docs-sdk
git checkout -b docs-sdk-3.0.2 <1>
git push origin docs-sdk-3.0.2 <2>
git checkout docs-sdk <3>
----
<1> Switch to a new base branch for the SDK v3 docs
<2> Push the new content branch to the lisk-docs repository
<3> Go back to the `docs-sdk` branch

The branch `docs-sdk` will be used as base for the new documentation.
All issues created for the new version will be merged into this new branch.

To do so, bump the `version` in `antora.yml`:

.On branch `docs-sdk`
[source,yaml]
----
name: lisk-sdk
title: Lisk SDK
version: 'v4' <1>
display_version: '4.0.0' <2>
start_page: ROOT:index.adoc
nav:
- modules/ROOT/nav.adoc
----

<1> Bump to the latest version (`v` + 1 digit).
<2> Change from `master` to the new version (3 digits SemVer).
This will be changed back to `master` as one of the last steps before the new docs release.

IMPORTANT: During the creation of the SDK v4 documentation, the docs in `docs-sdk-3.0.2` represent the latest version, therefore `site.yml` and `live-site.yml` in the `build` branch need to be updated accordingly.

== Content creation

Please create the content according to the guide xref:{url_contributing}[] and the xref:{url_styleguide}[].

The recommended order of updating the SDK docs is as follows:

. Navigation:
Take a look at the navigation in the `nav.adoc` file, and adjust the structure for the new version.
This will help you to get an overview about the upcoming changes, and to create tasks in the right scope.
. References
.. Update API specification with `swagger2markup`
+
[source,bash]
----
cd framework-plugins/lisk-framework-http-api-plugin
swagger2markup convert -i ./swagger.yml -d ~/swagger-spec
----
+
Then copy the content of the generated files and remove outdated links from the description.
.. Update Lisk Commander reference
.. Update Lisk Elements reference
.. Update Lisk Framework reference
.. Update Config reference
. Explanations
. Example applications
+
NOTE: These updates need to be done in the {url_github_sdk_examples}[lisk-sdk-examples^] repository.
. Tutorials
. Guides
. Changelog

== UI updates

Use `dev_antora` as base branch for all pull requests.
`dev_antora` is used in the {url_staging}[lisk-docs staging environment^].

* Update top navigation in `src/partials/header-content.hbs`:
** Check, if any links are outdated and update or remove them.
** Check, if any new links should be added.
** If a new documentation component is released: The new component needs to be added to show dynamically in the top left.


== Release preparations

=== Updates on `docs-sdk-3.0.2`

[[update_previous]]
==== Update `antora.yml`

IMPORTANT: This needs to be updated at the same time as on the <<update_latest,latest version branch>>.

* Create a new issue to update the version of the previous version branch in `antora.yml`.
* Change `master` to `3.0.2`.
* Change `3.0.2 (latest)` to `3.0.2`.

==== Updates on other branches like `docs-core-3.0.0-beta.0`

[NOTE]
====
Do not forget to check if you need to update in other components the references to pages in `docs-sdk-3.0.2` from `master` to `3.0.2`.
====

==== Add versions in snippets

[source,bash]
----
npm i lisk-sdk # before
----

[source,bash]
----
npm i lisk-sdk@3.0.2 # after
----

Do this for all Lisk Elements packages and Lisk Commander as well.

==== Update links to the SDK example apps

[source,asciidoc]
----
//before
:url_github_hello: https://github.com/LiskHQ/lisk-sdk-examples/tree/development/hello_world
----

[source,asciidoc]
----
//after
:url_github_hello: https://github.com/LiskHQ/lisk-sdk-examples/tree/development/archive/3.x/hello_world
----

=== Updates on `docs-sdk`

[[update_latest]]
==== Update `antora.yml`

IMPORTANT: This needs to be updated at the same time as on the <<update_previous,previous version branch>>.

* Change `4.0.0` to `master`.
* Change `4.0.0` to `4.0.0 (latest)`.

=== UI updates

Merge `dev-antora` into the `antora` branch.

.On branch `antora`
[source,bash]
----
git merge dev-antora
git push origin antora
----

==== Check redirects

Check, if new `page-aliases` need to be added to the page attributes.
This is the case in particular, if pages have been moved or removed in the latest version.

== Release

=== Update the live playbook

On branch `build`, add the content branch `docs-sdk` to playbook file `live-site.yml`.

.before
[source,yaml]
----
content:
  sources:
  - url: https://github.com/LiskHQ/lisk-docs.git
    branches: [docs-core, docs-service, docs-protocol, docs-sdk-2.3.8, docs-sdk-3.0.2, docs-core-2.1.6]
----

.after
[source,yaml]
----
content:
  sources:
  - url: https://github.com/LiskHQ/lisk-docs.git
    branches: [docs-core, docs-sdk, docs-service, docs-protocol, docs-sdk-2.3.8, docs-sdk-3.0.2, docs-core-2.1.6]
----

=== Building the new live documentation with Antora

.On the `build` branch
[source,bash]
----
source antora/.env
antora live-site.yml --fetch
cd live
git status
git add .
git commit -m "Update docs"
git push origin live
----

Now, it is needed to ask the Devops team to update the documentation on lisk.io.
They will then deploy the new content and flush the cache.

=== Updating the search index

Make sure Docker is started and that you are on branch `build`.

[source,bash]
----
cd searchdocs-scraper
----

First, make sure you have Docker running on your machine and that you can list images.

[source,bash]
----
docker images
----

Then, pass the config file to the `docsearch docker:run` command, which launches the provided Docker container (algolia/docsearch-scraper):

[source,bash]
----
pipenv run ./docsearch docker:run ./config.json
----

If that command succeeds, it means the index is now updated.

For more information about the setup and usage of the search index, check the guide xref:{url_search}[Setting up docsearch].

:!sectnums:
