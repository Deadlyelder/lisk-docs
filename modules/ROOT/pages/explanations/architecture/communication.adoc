= Communication Architecture
Mona Bärenfänger <mona@lightcurve.io>
//Settings
:toc:
:v_core: 3.0.0
:imagesdir: ../../../assets/images
//External URLs
// Project URLs

image::communication-architecture.png[]

//@TODO:exlpanations

== Action and event interfaces

The Lisk Framework defines actions and events which can be invoked and subscribed through a channel.

All modules and plugins will be given a `channel` to communicate with the application via actions and events.

=== How to invoke actions

<<application-actions>> can be invoked through the `channel`.
Additionally, all actions defined in modules and plugins can be called by every module an plugin in the application.

[source,typescript]
----
const { data } = await channel.invoke('app:getSchema'); <1>
const { data } = await channel.invoke('pluginAlias:getKnownTimestamps'); <2>
const { data } = await channel.invoke('moduleAlias:anotherAction'); <3>
const { data }= await channel.invoke('app:actionName', input); <4>
----

<1> How to invoke a default application action.
<2> How to invoke a plugin action.
<3> How to invoke a module action.
<4> Hot to invoke an action that needs some input.

=== How to publish and subscribe to events

<<application-events>> can be subscribed and published through the `channel`.
Additionally, all events defined in modules / plugins can be subscribed by every other module and plugin in the application.

[source,typescript]
----
channel.publish('pluginAlias:timestamp', { info: 'sample' }); <1>
channel.subscribe('pluginAlias:timestamp', ({ data }) => { <2>
  console.log(data.info);
});
----

<1> How to publish an event
<2> How to subscribe to an event

=== Application actions

[cols=",,",options="header",stripes="hover"]
|===
|Name
|Inputs
|Description

|`app:getConnectedPeers`
| none
|Returns all connected peers.

|`app:getDisconnectedPeers`
| none
|Returns all disconnected peers

|`app:getForgers`
| none
|Returns the status of all registered forgers information for current round

|`app:updateForgingStatus`
a|
[source,typescript]
----
{
address: string; <1>
password: string; <2>
forging: boolean; <3>
}
----
<1> binary address in hex string
<2> password to decrypt the passphrase
<3> when enabling forging, the value should be `true`
|Enable or disable forging for a registered forger in config

|`app:getForgingStatus`
| none
|Description

|`app:getTransactionsFromPool`
| none
|Description

|`app:postTransaction`
a|
[source,typescript]
----
{
  transaction: string; <1>
}
----
<1> encoded transaction in hex string
|Description

|`app:getLastBlock`
| none
|Description

|`app:getAccount`
a|
[source,typescript]
----
{
  address: string; <1>
}
----
<1> address in hex string
|Description

|`app:getAccounts`
a|
[source,typescript]
----
{
  address: string[]; <1>
}
----
<1> address in hex string
|Description

|`app:getBlockByID`
a|
[source,typescript]
----
{
  id: string; <1>
}
----
<1> block ID in hex string
|Description

|`app:getBlocksByIDs`
a|
[source,typescript]
----
{
  ids: string[]; <1>
}
----
<1> block ID in hex string
|Description

|`app:getBlockByHeight`
a|
[source,typescript]
----
{
  height: number; <1>
}
----
<1> block height
|Description

|`app:getBlocksByHeightBetween`
a|
[source,typescript]
----
{
  from: number; <1>
  to: number; <2>
}
----
<1> block height to fetch from
<2> block height to fetch to
|Description
|`app:getTransactionByID`
a|
[source,typescript]
----
{
  ids: string; <1>
}
----
<1> transaction ID in hex string
|Description
|`app:getTransactionsByIDs`
a|
[source,typescript]
----
{
  ids: string[]; <1>
}
----
<1> transaction ID in hex string
|Description
|`app:getSchema`
| none
|Description
|`app:getRegisteredModules`
| none
|Description
|`app:getNodeInfo`
| none
|Description
|===

=== Application events

* `app:ready` - Fired when the application starts
* `app:shutdown` - Fired when application stops
* `app:network:ready` - Fired when network has at least one outbound connection
* `app:network:event` - Fired when application receives P2P event from the network
* `app:transaction:new` - Fired when the node receives a new transaction
* `app:chain:fork` - Fired when the node received a block from forked chain
* `app:chain:validators:change` - Fired when node updates validator set
* `app:block:new` - Fired when a new block is added to the blockchain
* `app:block:delete` - Emitted when a block is deleted from blockchain
