= Connect a frontend
Mona Bärenfänger <mona@lightcurve.io>
:toc:
:imagesdir: ../../assets/images
:url_angular: https://angular.io/
:url_express: https://expressjs.com/
:url_github_hello: https://github.com/LiskHQ/lisk-sdk-examples/tree/development/hello_world
:url_github_sdk: https://github.com/LiskHQ/lisk-sdk
:url_pug: https://pugjs.org/
:url_react: https://reactjs.org/
:url_vue: https://vuejs.org/


This guide describes how to create a frontend or client app that interacts with a Lisk blockchain network.

NOTE: A **Lisk blockchain network** is a network of nodes that are built with the {url_github_sdk}[Lisk SDK].

== Choose a framework

Choose based on personal preference.

Some popular frameworks for developing apps are for example:

* {url_angular}[Angular]
* {url_react}[React]
* {url_vue}[Vue]

NOTE: This guide uses {url_pug}[Pug](aka Jade) to create a frontend application.

== Create project structure

TIP: See the full code example of {url_github_hello}[Hello World at GitHub].

.Structure of the Hello World app
....
.
├── README.md
├── client
│   ├── accounts.json
│   ├── app.js
│   ├── package-lock.json
│   ├── package.json
│   ├── print_sendable_hello-world.js
│   ├── public
│   │   ├── basiercircle-bold.woff
│   │   ├── basiercircle-regular.woff
│   │   ├── basiercircle-semibold.woff
│   │   ├── favicon-32x32.png
│   │   └── lisk-logo-light.svg
│   └── views
│       ├── accounts.pug
│       ├── blocks.pug
│       ├── create.pug
│       ├── css
│       │   ├── base.css
│       │   └── header.css
│       ├── faucet.pug
│       ├── hello-accounts.pug
│       ├── hello-transactions.pug
│       ├── index.pug
│       ├── payload.pug
│       ├── post-hello.pug
│       ├── transactions.pug
│       └── transfer.pug
├── hello_transaction.js
├── index.js
├── logs
│   ├── devnet
│   │   ├── lisk.log
│   │   └── lisk_db.log
│   └── lisk_db.log
├── package-lock.json
└── package.json
....

=== Node project

Clone the [lisk-sdk-examples on GitHub] and navigate into `hello_world/client` folder.

Or create a new client app manually.
Note, that this client app is relying on a node with a reachable API, so it might be needed to adjust `API_BASEURL`.
In order to process custom transactions, it is needed to require these transaction in the client app as well.
[source,bash]
----
mkdir client
cd client
npm init --yes
npm i @liskhq/lisk-transactions @liskhq/lisk-cryptography @liskhq/lisk-passphrase @liskhq/lisk-api-client body-parser express pug
mkdir views
mkdir views/css
mkdir public
----

=== Views

[[index_pug]]
.views/index.pug
[source,jade]
----
doctype html
html(lang="en")
    head
        title Hello Lisk
        link(href='favicon-32x32.png', rel='icon', type='image/png')
        link(href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css', rel='stylesheet')
        link(href='https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism.min.css', rel='stylesheet')
        script(src='https://code.jquery.com/jquery-3.3.1.slim.min.js')
        script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js')
        script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js')
        script(src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-core.min.js')
        script(src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js')
        style
            include css/base.css
            include css/header.css

        body
        block menu
            header.header
                nav.navbar
                    div.navbar-content
                        div.navbar-brand
                            a(href='/').lisk-logo
                            span.nav-brand__name-area
                                strong.nav-brand__name-area__title Hello
                        div#topbar-nav.navbar-menu
                            div.navbar-end
                                a(href='/create').navbar-item Create Credentials
                                a(href='/faucet').navbar-item Faucet
                                a(href='/post-hello').navbar-item Send Hello
                                a(href='/transfer').navbar-item Send Transfer
                                a.divider-vertical
                                a(href='/accounts').navbar-item Accounts
                                a(href='/hello-accounts').navbar-item Hello Accounts
                                a(href='/blocks').navbar-item Blocks
                                a(href='/transactions').navbar-item Transactions
                                a(href='/hello-transactions').navbar-item Hello Tx

        .container
            block content
                .jumbotron
                    h1 Hello Lisk!
                    p.lead
                        | A basic frontend for blockchain application uilt with the Lisk SDK.
----

This will create the following start page for the app:

image:hello-index.png[]

=== JavaScript

Create a file that will contain the JavaScript code for the client.
We call it `app.js` in this example.

In the first lines of `app.js`, all necessary dependencies are required.

Next, the Lisk API client and the {url_express}[Express] server are initialized and configured.

Next, the <<pages, routes>> are defined for the different views of the client.

.app.js
[source,js]
----
const express = require('express');
const bodyParser = require('body-parser');
const accounts = require('./accounts.json');
const { APIClient } = require('@liskhq/lisk-api-client');
const HelloTransaction = require('../hello_transaction');
const transactions = require('@liskhq/lisk-transactions');
const cryptography = require('@liskhq/lisk-cryptography');
const { Mnemonic } = require('@liskhq/lisk-passphrase');

const networkIdentifier = cryptography.getNetworkIdentifier(
    "23ce0366ef0a14a91e5fd4b1591fc880ffbef9d988ff8bebf8f3666b0c09597d",
    "Lisk",
);

// Constants
const API_BASEURL = 'http://localhost:4000';
const PORT = 3000;

// Initialize
const app = express();
const api = new APIClient([API_BASEURL]);

app.locals.payload = {
    tx: null,
    res: null,
};

// Configure Express
app.set('view engine', 'pug');
app.use(express.static('public'));

// parse application/json
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

/* Utils */
const dateToLiskEpochTimestamp = date => (
    Math.floor(new Date(date).getTime() / 1000) - Math.floor(new Date(Date.UTC(2016, 4, 24, 17, 0, 0, 0)).getTime() / 1000)
);

/* Routes */
app.get('/', (req, res) => {
    res.render('index');
});


app.listen(PORT, () => console.info(`Explorer app listening on port ${PORT}!`));
----

To start the app:

.In terminal
[source,bash]
----
node app.js
----

=== Styles

Create an intuitive and beautiful design for the app.

==== CDN

<<index_pug, Include remote styles via CDN(= Content Delivery Network)>>.

==== CSS files

Include local styles by adding `.css` files inside the `views/css` directory.

Then, reference the `.css` files in the <<index_pug, pug index file>>.

[[pages]]
== Create pages

Implement the logic and structure of the different pages of the client app.

=== New account

image:hello-new_account.png[]

.client/views/create.pug
[source,jade]
----
extends index.pug

block content
    h2 Create a new account

    p
        | Refresh page to get new Credentials

    pre
        code(class='language-json')= JSON.stringify(packetCredentials, null, 2)
----

.client/app.js
[source,js]
----
app.get('/create', async(req, res) => {
    const getPacketCredentials = () => {
        const passphrase = Mnemonic.generateMnemonic();
        const keys = cryptography.getPrivateAndPublicKeyFromPassphrase(
            passphrase
        );
        const credentials = {
            address: cryptography.getAddressFromPublicKey(keys.publicKey),
            passphrase: passphrase,
            publicKey: keys.publicKey,
            privateKey: keys.privateKey
        };
        return credentials;
    };

    const packetCredentials = getPacketCredentials();
    res.render('create', { packetCredentials });
});
----

=== Faucet

image:hello-faucet.png[]

.client/views/faucet.pug
[source,jade]
----
extends index.pug

block content
    h2 Faucet
    p
        | Send funds to account from Genesis

    form(method='POST' action='/faucet')
        div.form-group
            label(for='address') Address:
            input.form-control(type='text', placeholder='address' name='address' id='address')
        div.form-group
            label(for='amount') Amount (LSK):
            input#amount.form-control(type='text', placeholder='200' name='amount')
        button.btn.btn-warning(type='submit') Fund
----

.client/app.js
[source,js]
----
app.post('/faucet', function (req, res) {
    const address = req.body.address;
    const amount = req.body.amount;

    const fundTransaction = new transactions.TransferTransaction({
        asset: {
            recipientId: address,
            amount: transactions.utils.convertLSKToBeddows(amount),
        },
        networkIdentifier: networkIdentifier,
        timestamp: dateToLiskEpochTimestamp(new Date()),
    });

    //The TransferTransaction is signed by the Genesis account
    fundTransaction.sign(accounts.genesis.passphrase);
    api.transactions.broadcast(fundTransaction.toJSON()).then(response => {
        res.app.locals.payload = {
            res: response.data,
            tx: fundTransaction.toJSON(),
        };
        console.log("++++++++++++++++ API Response +++++++++++++++++");
        console.log(response.data);
        console.log("++++++++++++++++ Transaction Payload +++++++++++++++++");
        console.log(fundTransaction.stringify());
        console.log("++++++++++++++++ End Script +++++++++++++++++");
        res.redirect('/payload');
    }).catch(err => {
        console.log(JSON.stringify(err.errors, null, 2));
        res.app.locals.payload = {
            res: err,
            tx: fundTransaction.toJSON(),
        };
        res.redirect('/payload');
    });
});
----

=== Send default transaction

image:hello-transfer.png[]

.client/views/transfer.pug
[source,jade]
----
extends index.pug

block content
    h2 Transfer tokens
    p
        | Send funds from one account to another.

    form(method='POST' action='/transfer')
        div.form-group
            label(for='address') Address:
            input.form-control(type='text', placeholder='address' name='address' id='address')
        div.form-group
            label(for='amount') Amount (LSK):
            input#amount.form-control(type='text', placeholder='200' name='amount')
        div.form-group
            label(for='passphrase') Passphrase:
            input#passphrase.form-control(type='text', placeholder='coach pupil shock error defense outdoor tube love action exist search idea' name='passphrase')
        button.btn.btn-warning(type='submit') Send
----

.client/app.js
[source,js]
----
app.post('/transfer', function (req, res) {
    const address = req.body.address;
    const amount = req.body.amount;

    const transferTransaction = new transactions.TransferTransaction({
        asset: {
            recipientId: address,
            amount: transactions.utils.convertLSKToBeddows(amount),
        },
        networkIdentifier: networkIdentifier,
        timestamp: dateToLiskEpochTimestamp(new Date()),
    });

    transferTransaction.sign(req.body.passphrase);
    api.transactions.broadcast(transferTransaction.toJSON()).then(response => {
        res.app.locals.payload = {
            res: response.data,
            tx: transferTransaction.toJSON(),
        };
        console.log("++++++++++++++++ API Response +++++++++++++++++");
        console.log(response.data);
        console.log("++++++++++++++++ Transaction Payload +++++++++++++++++");
        console.log(transferTransaction.stringify());
        console.log("++++++++++++++++ End Script +++++++++++++++++");
        res.redirect('/payload');
    }).catch(err => {
        console.log(JSON.stringify(err.errors, null, 2));
        res.app.locals.payload = {
            res: err,
            tx: transferTransaction.toJSON(),
        };
        res.redirect('/payload');
    });
});
----

=== Send custom transaction

image:hello-hello.png[]

.client/views/post-hello.pug
[source,jade]
----
extends index.pug

block content
    h2 Create new Hello

    form(method='POST' action='/post-hello')
        div.form-group
            label(for='hello') Hello value:
            input#recipient.form-control(type='text', placeholder='Your personal hello statement' name='hello')
        div.form-group
            label(for='passphrase') Passphrase:
            input#recipient.form-control(type='text', placeholder='coach pupil shock error defense outdoor tube love action exist search idea' name='passphrase')
        button.btn.btn-warning(type='submit') Send
----

.client/app.js
[source,js]
----
app.post('/post-hello', function (req, res) {
    const helloString = req.body.hello;
    const passphrase = req.body.passphrase;

    const helloTransaction = new HelloTransaction({
        asset: {
            hello: helloString,
        },
        networkIdentifier: networkIdentifier,
        timestamp: dateToLiskEpochTimestamp(new Date()),
    });

    helloTransaction.sign(passphrase);

    api.transactions.broadcast(helloTransaction.toJSON()).then(response => {
        res.app.locals.payload = {
            res: response.data,
            tx: helloTransaction.toJSON(),
        };
        console.log("++++++++++++++++ API Response +++++++++++++++++");
        console.log(response.data);
        console.log("++++++++++++++++ Transaction Payload +++++++++++++++++");
        console.log(helloTransaction.stringify());
        console.log("++++++++++++++++ End Script +++++++++++++++++");
        res.redirect('/payload');
    }).catch(err => {
        console.log(JSON.stringify(err.errors, null, 2));
        res.app.locals.payload = {
            res: err,
            tx: helloTransaction.toJSON(),
        };
        res.redirect('/payload');
    });
});;
----

=== Get all blocks

image:hello-blocks.png[]

.client/views/blocks.pug
[source,jade]
----
extends index.pug

block content
    h2 Blocks

    pre
        table.table.table-striped
            thead
                tr
                    th(scope='col') ID
                    th(scope='col') Height
                    th(scope='col') Data

            tbody
                each block in blocks
                    tr
                        td= block.id
                        td= block.height
                        td= JSON.stringify(block, null, 2)
----

.client/app.js
[source,js]
----
app.get('/blocks', async(req, res) => {
    let offset = 0;
    let blocks = [];
    const blocksArray = [];

    do {
        const retrievedBlocks = await api.blocks.get({ limit: 100, offset });
        blocks = retrievedBlocks.data;
        blocksArray.push(...blocks);

        if (blocks.length === 100) {
            offset += 100;
        }
    } while (blocks.length === 100);


    res.render('blocks', { blocks: blocksArray });
});
----

=== Get all transactions

image:hello-transactions.png[]

.client/views/transactions.pug
[source,jade]
----
extends index.pug

block content
    h2 Transactions

    pre
        table.table.table-striped
            thead
                tr
                    th(scope='col') ID
                    th(scope='col') Height
                    th(scope='col') Data

            tbody
                each tx in transactions
                    tr
                        td= tx.id
                        td= tx.height
                        td= JSON.stringify(tx, null, 2)
----

.client/app.js
[source,js]
----
app.get('/transactions', async(req, res) => {
    let offset = 0;
    let txs = [];
    const transactionsArray = [];

    do {
        const retrievedTransactions = await api.transactions.get({ limit: 100, offset });
        txs = retrievedTransactions.data;
        transactionsArray.push(...txs);

        if (txs.length === 100) {
            offset += 100;
        }
    } while (txs.length === 100);

    // Sort desc
    transactionsArray.sort((a, b) => {
        if (a.timestamp > b.timestamp) return -1;

        if (a.timestamp < b.timestamp) return 1;

        if (a.timestamp === b.timestamp) return 0;
    });

    res.render('transactions', { transactions: transactionsArray });
});
----

=== Get transactions by type

image:hello-hello_transactions.png[]

.client/views/hello-transactions.pug
[source,jade]
----
extends index.pug

block content
    h2 Transactions

    pre
        table.table.table-striped
            thead
                tr
                    th(scope='col') ID
                    th(scope='col') Height
                    th(scope='col') Data

            tbody
                each tx in transactions
                    tr
                        td= tx.id
                        td= tx.height
                        td= JSON.stringify(tx, null, 2)
----

.client/app.js
[source,js]
----
app.get('/hello-transactions', async(req, res) => {
    const { data: transactions } = await api.transactions.get({ type: HelloTransaction.TYPE });

    // Sort desc
    transactions.sort((a, b) => {
        if (a.timestamp > b.timestamp) return -1;

        if (a.timestamp < b.timestamp) return 1;

        if (a.timestamp === b.timestamp) return 0;
    });

    res.render('hello-transactions', { transactions });
});
----

=== Get all account

image:hello-accounts.png[]

.client/views/accounts.pug
[source,jade]
----
extends index.pug

block content
    h2 Accounts

    pre
        table.table.table-striped
            thead
                tr
                    th(scope='col') Index
                    th(scope='col') Address
                    th(scope='col') Balance
                    th(scope='col') Data

            tbody
                each account, index in accounts
                    tr
                        td= index
                        td= account.address
                        td= account.balance
                        td= JSON.stringify(account, null, 2)

----

.client/app.js
[source,js]
----
app.get('/accounts', async(req, res) => {
    let offset = 0;
    let accounts = [];
    const accountsArray = [];

    do {
        const retrievedAccounts = await api.accounts.get({ limit: 100, offset });
        accounts = retrievedAccounts.data;
        accountsArray.push(...accounts);

        if (accounts.length === 100) {
            offset += 100;
        }
    } while (accounts.length === 100);


    res.render('accounts', { accounts: accountsArray });
});
----

==== Detail page for accounts

image:hello-accounts_detail.png[]

.client/app.js
[source,js]
----
app.get('/accounts/:address', async(req, res) => {
    const { data: accounts } = await api.accounts.get({ address: req.params.address });
    res.render('accounts', { accounts });
});
----

=== Get accounts based on asset data

image:hello-hello_accounts.png[]

.client/views/create.pug
[source,jade]
----
extends index.pug

block content
    h2 Hello Accounts

    pre
        table.table
            thead
                tr
                    th(scope='col') Address
                    th(scope='col') Balance
                    th(scope='col') Hello

            tbody
                each account in accounts
                    tr
                        td= account.address
                        td= account.balance
                        td
                            pre= JSON.stringify(account.asset.hello, null, 2)
----

.client/app.js
[source,js]
----
app.get('/hello-accounts', async(req, res) => {
    let offset = 0;
    let accounts = [];
    let accountsArray = [];

    do {
        const retrievedAccounts = await api.accounts.get({ limit: 100, offset });
        accounts = retrievedAccounts.data;
        accountsArray.push(...accounts);

        if (accounts.length === 100) {
            offset += 100;
        }
    } while (accounts.length === 100);

    let assetAccounts = [];
    for (var i = 0; i < accountsArray.length; i++) {
        let accountAsset = accountsArray[i].asset;
        if (accountAsset && Object.keys(accountAsset).indexOf("hello") > -1){
            assetAccounts.push(accountsArray[i]);
        }
    }

    res.render('hello-accounts', { accounts: assetAccounts });
});
----
