= SDK Architecture
Mona Bärenfänger <mona@lightcurve.io>
//Settings
:page-aliases: lisk-framework/index.adoc
:toc:
:idprefix:
:idseparator: -
:imagesdir: ../../assets/images
// Project URLs
:url_commander: references/lisk-commander/index.adoc
:url_elements: references/lisk-elements/index.adoc
:url_framework: references/lisk-framework/index.adoc
:url_elements_packages: references/lisk-elements/index.adoc
:url_explanations_on_chain: introduction/modules.adoc
:url_explanations_off_chain: introduction/plugins.adoc
:url_explanations_communication: advanced-explanations/communication.adoc
:url_guides_setup: guides/app-development/setup.adoc
:url_guides_config: guides/app-development/configuration.adoc
:url_guide_genesis_block: guides/app-development/genesis-block.adoc
:url_references_config: references/lisk-framework/config.adoc
:url_references_elements_genesis: references/lisk-elements/genesis.adoc
:url_references_framework_basemodule: references/lisk-framework/index.adoc#the-basemodule
:url_protocol_genesis_block: protocol:blocks.adoc#genesis-block
:url_protocol: protocol:index.adoc
:url_introduction_bapps_defaultmodules: introduction/blockchain-applications.adoc#default-modules
:url_introduction_bapps_diagram: introduction/blockchain-applications.adoc#architecture-diagram

The Lisk SDK operates on the Node.js runtime and consists primarily of an application framework (xref:{url_framework}[Lisk Framework]).
This consists of a collection of libraries providing blockchain application functionalities (xref:{url_elements}[Lisk Elements]), and a powerful Command Line Interface (xref:{url_commander}[Lisk Commander]), which allows developers to manage a Lisk node instance and interact with a Lisk compatible network.

image::diagram_sdk.png[Diagram]

== SDK components

[width="100%",cols="23%,77%",options="header",]
|===
| Component | Description
| xref:{url_framework}[Lisk Framework] | Lisk Framework is an application framework responsible for establishing and maintaining the interactions between the different xref:{url_introduction_bapps_diagram}[components] of a blockchain application.

| xref:{url_elements}[Lisk Elements] | Lisk Elements is a collection of libraries, each of them implementing some form of blockchain application functionality such as cryptography, transactions, p2p, etc.
Each library is designed to be compatible with xref:{url_protocol}[].

| xref:{url_commander}[Lisk Commander] | Lisk Commander is a command line tool which provides various commands to simplify the development and management of blockchain applications.
For example, it allows to xref:{url_guides_setup}[bootstrap] a complete blockchain application with 1 command.
|===

== Application

The framework architecture is constructed of three different layer of abstractions: `Node`, `Modules` and `Plugins` (see the xref:{url_introduction_bapps_diagram}[architecture diagram] of a blockchain application).
The `Application` object encapsulates all together to provide a user-facing interface.

The `Application` class is the entry point to create a blockchain application.
It can be instantiated in two ways:

[source,js]
----
//Initiates the Application including all default modules
const app = Application.defaultApplication(genesisBlock, config);
//Initiates the Application without default modules
const app = new Application(genesisBlock, config);
----

`genesisBlock` represents the <<genesis-block>> and `config` represents the <<configuration>> for the application.

.Recommended: Use the default application
[TIP]
The recommended method to create an `Application` instance is to use the *defaultApplication*, since it comes with the xref:{url_introduction_bapps_defaultmodules}[default modules].
If the class constructor is used, all modules need to be registered manually.

== Configuration

The application config object is passed to the `Application` and must follow the xref:{url_references_config}[configuration schema].

[NOTE]
It is not necessary to include all options that are included in the schema.
The application will use the default configuration options in case a config option is not specified.

More information about how to configure a blockchain application can be found in the guide xref:{url_guides_config}[].

== Genesis block

The xref:{url_protocol_genesis_block}[genesis block] describes the very first block in the blockchain.
It defines the initial state of the blockchain on start of the network.

All nodes within the same blockchain network share the same genesis block.
Different blockchain networks will always have different genesis blocks.

The genesis block is not forged by a delegate, such as all of the other blocks which come after the genesis block.
Instead it is defined by the developer, when creating the Application instance of the blockchain application.

TIP: Check the xref:{url_guide_genesis_block}[] guide to learn how to create a valid genesis block.

.Genesis block schema
[source,js]
----
const genesisBlock = {
  header: {
    generatorPublicKey: "",
    // height can be either 0 or regenesis height
    height: number,
    // empty buffer or merkle root of the previous blocks from previous network
    previousBlockID: Buffer,
    reward: 0n,
    signature: "",
    // timestamp of the blockchain in unix timestamp in second
    timestamp: number,
    // transactionRoot is alway empty hash
    transactionRoot: Buffer.from('e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855', 'hex'),
    version: 0,
    asset: {
      // number of initial round to use the initDelegates
      initRounds: number,
      // address of initial delegates
      initDelegates: Buffer[],
      // encoded accounts for the initial state
      accounts: Buffer[],
    },
  },
  payload: [],
}
----

== Life cycle of a block

If a node receives a new block, it always performs the following actions.

The *bold* steps are the steps exposed to the developer via the base module and base asset, see the xref:{url_references_framework_basemodule}[Lisk Framework reference].

. Receive block
. Apply fork choice rule
. Validate block
.. Validate transactions
... Validate transaction
... *Validate transaction asset*
. Verify block header
. *Before block apply*
. *Apply block*
.. Apply transactions
... *beforeTransactionApply*
... *Apply asset*
... *afterTransactionApply*
. *After block apply*
. Save block and updated states
