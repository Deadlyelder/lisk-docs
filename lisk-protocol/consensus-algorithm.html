<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Consensus algorithm
- Lisk
Protocol
Docs</title>
    <link rel="canonical" href="https://lisk.io/documentation/lisk-protocol/consensus-algorithm.html">
    <meta name="description" content="This section illustrates how the delegates eligible to create blocks are selected and how they reach agreement on new blocks.">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/site-extra.css">
      <link rel="stylesheet" href="../_/css/vendor/docsearch.min.css">
      <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<link rel="icon" href="/sites/default/files/favicons/favicon-32x32.png" type="image/png">
  </head>
  <body class="article">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NKNKGHL');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKNKGHL"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header class="header">
  <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-brand">
          <a href="https://lisk.io" title="Lisk.io" class="lisk-logo"></a>
            <span  class="nav-brand__name-area">
              <strong class="nav-brand__name-area__title">protocol</strong>
            </span>
                    <button class="navbar-burger" data-target="topbar-nav">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
          <div class="navbar-end">
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="">Docs</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-protocol/">Lisk protocol</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/">Lisk SDK</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/">Lisk Core</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="">Resources</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href=""><strong>Lisk Core API</strong></a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/reference/api.html">Testnet</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/reference/api-mainnet.html">Mainnet</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/3.0.0/reference/api.html">Betanet</a>
                <hr class="navbar-divider">
                <a class="navbar-item" href=""><strong>Lisk Network Explorer</strong></a>
                <a class="navbar-item" target="_blank" href="https://testnet-explorer.lisk.io/">Testnet<i class="icofont-external-link"></i></a>
                <a class="navbar-item" target="_blank" href="https://explorer.lisk.io/">Mainnet<i class="icofont-external-link"></i></a>
                <a class="navbar-item" target="_blank" href="https://betanet-explorer.lisk.io/">Betanet<i class="icofont-external-link"></i></a>
              </div>
            </div>
          </div>
            <div class="navbar-menu search-box hide-for-print">
              <input id="search-input" type="text" placeholder="Search docs">
            </div>
        </div>
        <div class="navbar-item">
          <a href="https://lisk.chat" title="Lisk Chat" target="_blank" class="footer__icon icon-discord"></a>
          <a href="https://github.com/LiskHQ" title="Lisk GitHub" target="_blank" class="footer__icon icon-github-2x"></a>
          <span class="control">
            <a class="button is-primary" target="_blank" title="Lisk Dev Forum" href="https://dev.lisk.io/">Get help</a>
          </span>
        </div>
      </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lisk-protocol" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Lisk protocol</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="accounts.html">Accounts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="blocks.html">Blocks</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="consensus-algorithm.html">Consensus algorithm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="network.html">Network</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="mainnet.html">Lisk Mainnet</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk protocol</span>
    <span class="version">5.0</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Lisk Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../lisk-core/index.html">2.1.6 (latest)</a>
        </li>
        <li class="version">
          <a href="../lisk-core/3.0.0/index.html">3.0.0-beta.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Lisk protocol</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">5.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Lisk SDK</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../lisk-sdk/index.html">3.0.2 (latest)</a>
        </li>
        <li class="version">
          <a href="../lisk-sdk/4.0.0/index.html">4.0.0</a>
        </li>
        <li class="version">
          <a href="../lisk-sdk/2.3.8/index.html">2.3.8</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../lisk-sdk/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Lisk protocol</a></li>
    <li><a href="consensus-algorithm.html">Consensus algorithm</a></li>
  </ul>
</nav>
<button class="toc-toggle"></button>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/docs-protocol/modules/ROOT/pages/consensus-algorithm.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Consensus algorithm</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section describes two important parts of the Lisk protocol which together are referred to as consensus algorithm.</p>
</div>
<div class="paragraph">
<p>The first part describes the protocol for deciding who is allowed to add a new block to the blockchain.
Lisk uses <strong>Delegated Proof-of-Stake</strong>, which means that every Lisk holder can vote for delegates, and depending on these votes certain delegates are allowed to add blocks to the blockchain in a certain order.
Delegates are simply normal Lisk accounts, which performed a <a href="transactions.html#delegate" class="page">delegate registration transaction</a>.</p>
</div>
<div class="paragraph">
<p>The second part of this section explains the <strong>Lisk-BFT</strong> consensus protocol.
This protocol determines how delegates choose the chain to which they add a new block, and when a block (and all included transactions) is irrevocably deemed part of the blockchain.
In addition, the security guarantees of the consensus protocol are also covered here.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dpos"><a class="anchor" href="#dpos"></a>Lisk delegated Proof-of-Stake</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="voting_and_weight"><a class="anchor" href="#voting_and_weight"></a>Delegates, voting and delegate weight</h3>
<div class="paragraph">
<p>A <strong>delegate</strong> is an account which performed a <a href="transactions.html#delegate" class="page">delegate registration transaction</a>.
An account can vote for any delegate using a <a href="transactions.html#vote" class="page">vote transaction</a>.
A vote that a delegate account casts for themselves is further called a <span id="index-self-vote-1"><strong>self-vote</strong></span>.
Depending on the votes cast, every delegate has an associated <span id="index-delegate_weight"><strong>delegate weight</strong></span>, which is an indicator for the support for this delegate in the network.
Formally, the delegate weight is defined as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>minimum { 10 * selfVotes , totalVotes },</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>selfVotes</code> is the amount the delegate voted for themselves, and <code>totalVotes</code> is the sum of all vote amounts (including self-votes) for that specific delegate.
This definition implies that the self-votes are always at least 10 % of the delegate weight and thus delegates always have substantial skin in the game.</p>
</div>
</div>
<div class="sect2">
<h3 id="delegate_selection"><a class="anchor" href="#delegate_selection"></a>Forging delegate selection</h3>
<div class="paragraph">
<p>Blocks in the Lisk protocol are grouped together into batches of 103 consecutive blocks, which are referred to as a <span id="index-round-1"><strong>round</strong></span>.
Every round has a <span id="index-forger_list-1"><strong>forger list</strong></span>, which is an ordered list of 103 delegates that are allowed to forge a block in that round.
Starting with the first delegate on the forger list, every delegate has a 10 second block slot window in which they can forge a block and broadcast it to the network.
If every delegate on the list manages to forge a block in their block slot building on the block by the previous delegate, a round lasts 1030 seconds (around 17 minutes).
It can happen that a delegate <span id="index-misses_the_block_slot-1"><strong>misses the block slot</strong></span>, meaning that there is no block added to the chain by the delegate in their designated block slot.
Consequently, the end of the forger list is reached before 103 blocks are added to the chain.
In this case, block slots are assigned again from the beginning of the forger list until 103 blocks are forged.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/unif_diagrams/forgerList.png" alt="forgerList">
</div>
</div>
<div class="paragraph">
<p>The forger list is computed taking into account the delegate weights and some random values submitted by delegates as part of their block.
The top 101 delegates by delegate weight are called <span id="index-active_delegate-1"><strong>active delegates</strong></span>, whereas all other delegates with a delegate weight of at least 10<sup>11</sup> (1000 LSK in Lisk Mainnet) are referred to as <span id="index-standby_delegate-1"><strong>standby delegates</strong></span>.
Specifically, the forger list for a round is generated as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Compute two values <code>randomSeed1</code> and <code>randomSeed2</code> from the values provided by the delegates in the <code>seedReveal</code> property of the block headers of the previous 3 rounds.</p>
</li>
<li>
<p>Add the 101 active delegates to the list. Moreover, add 2 standby delegates to the list using a random selection proportional to delegate weight.
The random selection utilizes <code>randomSeed1</code> and <code>randomSeed2</code>, respectively.
The computation of 101 active delegates as well as the standby delegate selection is based on the delegate weights from two rounds before.</p>
</li>
<li>
<p>Shuffle the list using <code>randomSeed2</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The random selection of two standby delegates and the commit-reveal scheme that the <code>seedReveal</code> values provided by the delegates in the block header must follow are described in detail in <a href="https://github.com/LiskHQ/lips/blob/master/proposals/lip-0022.md">LIP 0022</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_banning_of_unproductive_delegates"><a class="anchor" href="#_banning_of_unproductive_delegates"></a>Banning of unproductive delegates</h3>
<div class="paragraph">
<p>As a fail-safe mechanism, a delegate that does not forge blocks for an extended period of time is banned.
This is to avoid the situation where a delegate who is not running a node leads to frequent missed block slots.
More specifically, a delegate is banned in case they miss 50 consecutive blocks, and the height of the last block they forged differs by more than 260,000 from the current height of the chain (the block is 30 days old).
As soon as a delegate is banned, they are excluded from being added to the forger list.
The ban is permanent, but the delegate account holder can move their funds to a different account and register a new delegate.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lisk_bft"><a class="anchor" href="#lisk_bft"></a>Lisk-BFT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Lisk-BFT protocol is formally defined in the related research paper "A lightweight BFT consensus protocol for blockchains" (<a href="https://arxiv.org/abs/1903.11434">arXiv</a>).
This section provides a high-level overview of the Lisk-BFT protocol and its security guarantees.</p>
</div>
<div class="sect2">
<h3 id="fork_choice_rules"><a class="anchor" href="#fork_choice_rules"></a>Consensus votes on blocks and fork choice rule</h3>
<div class="paragraph">
<p>The Lisk-BFT protocol uses special <span id="index-consensus_votes"><strong>consensus votes</strong></span> that the forging delegates cast for blocks.
These consensus votes are necessary because there can be multiple valid chains and, in particular, multiple valid blocks at the same height due to network delays, for instance.
In this case, the delegates and nodes in the network need a protocol to agree on one of the chains.
The consensus votes are used to indicate what a forging delegate believes to be the correct block at a given height.
They are completely unrelated to the votes used to determine the forging delegates.</p>
</div>
<div class="paragraph">
<p>There are two types of consensus votes, the first is called a <span id="index-prevote-1"><strong>prevote</strong></span>, and the second is called a <span id="index-precommit-1"><strong>precommit</strong></span>.
Only the 101 current active delegates can cast these consensus votes for a block and therefore the number of prevotes or precommits for a block ranges from 0 to 101.
The consensus votes are not sent explicitly, but are implied by the <code>maxHeightPreviouslyForged</code> property that delegates need to include in the blocks they forge.
For this property, delegates are supposed to provide the largest height of any block they previously forged and thereby disclose if they previously forged on a different chain.</p>
</div>
<div class="paragraph">
<p>The <span id="index-fork_choice_rule-1"><strong>fork choice rule</strong></span> defines to which chain a delegate is supposed to add a block in case there are multiple chains.
In the Lisk-BFT protocol delegates choose the chain where the block at the tip of the chain has the largest <code>maxHeightPrevoted</code> value (and largest <code>height</code> value in case of a tie).
The <code>maxHeightPrevoted</code> property of a block has to be equal to the largest height of an <span id="index-ancestor_block-1"><strong>ancestor block</strong></span> with at least 68 prevotes (an ancestor block is a predecessor block in the chain).</p>
</div>
</div>
<div class="sect2">
<h3 id="_finality_and_security_guarantees"><a class="anchor" href="#_finality_and_security_guarantees"></a>Finality and security guarantees</h3>
<div class="paragraph">
<p>As soon as one block has at least 68 precommits, the block and all its ancestor blocks are considered <span id="index-final-1"><strong>final</strong></span>.
This means they are irrevocably deemed part of the blockchain and never reverted.
Two blocks are called <span id="index-conflicting-1"><strong>conflicting</strong></span> if they are part of different chains, i.e., none is an ancestor block of the other.
The most important security property for a consensus algorithm is to guarantee that two conflicting blocks are never considered final, as otherwise a blockchain can be subject to double-spending attacks, for instance.
For the case of a static set of 101 active delegates (i.e., the active delegates are not changing from round to round), the Lisk-BFT protocol provides the following security guarantees:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If at most 33 active delegates are <span id="index-Byzantine-1"><strong>Byzantine</strong></span> (malicious), and all other active delegates obey the rules of the Lisk-BFT protocol, two conflicting blocks are never finalized.</p>
</li>
<li>
<p>If the active delegates obey the rules of the Lisk-BFT protocol and at most 33 active delegates stop forging or casting consensus votes, new blocks can always be finalized.</p>
</li>
<li>
<p>A violation of the Lisk-BFT protocol by a delegate can be detected and the respective delegate can be punished, as outlined in the next section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In case the set of active delegates changes over time, the security guarantees are only slightly weaker.
For details, please refer to the Lisk-BFT research paper (<a href="https://arxiv.org/abs/1903.11434">arXiv</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="punishment"><a class="anchor" href="#punishment"></a>Punishment of Lisk-BFT protocol violations</h3>
<div class="paragraph">
<p>If a delegate casts contradictory consensus votes due to an incorrect <code>maxHeightPreviouslyForged</code> in the block header or violates the fork choice rule, there must be two signed blocks by that delegate which are proof of the protocol violation.
The signed block headers can be included by anyone as part of a <a href="transactions.html#pom" class="page">proof-of-misbehavior transaction</a> and submitted to the network.
Once this transaction is included in the blockchain, the delegate that violated the Lisk-BFT consensus protocol and forged the two blocks provided in the proof-of-misbehavior transaction is punished by setting the delegate weight to 0 for the next 780,000 blocks (approximately 3 month).
Additionally, the unlocking period for self-votes is increased from 260,000 blocks to 780,000 blocks (from approximately 1 month to 3 months) for the respective delegate.
This affects any vote amount that is used for self-voting or is still in the unlocking period at the inclusion height of the proof-of-misbehavior.
Similarly, for all accounts voting for the punished delegate, the unlocking period for the votes for the punished delegate is increased from 2,000 blocks to 260,000 blocks (from approximately 5 hours to 1 month).
Again, this affects any amount used by the account to vote for the punished delegate or amounts that were used for voting for the punished delegate, but were still in the unlocking period at the inclusion height of the proof-of-misbehavior.
This means that both the delegate as well as the accounts voting for that delegate are punished by their tokens being locked for an extended amount of time.</p>
</div>
</div>
</div>
</div>
    <div class="bottom-links">
    <div>
      <a class="bottom-link" href="/documentation/lisk-protocol/blocks.html"><i class="icofont-double-left icofont-3x"></i>Blocks
    </a>
    </div><div>
      <a class="bottom-link" href="/documentation/lisk-protocol/network.html">Network<i class="icofont-double-right icofont-3x"></i>
      </a>
    </div>
  </div>






</article>
<aside class="article-aside hidden" role="navigation">
</aside>


<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
    <div class="footer__container">
        <div class="footer__copyright">
            <div class="institutional-links-2">
                <span class="institutional-links-2__item">© 2020 Lisk Foundation</span>
                <a class="institutional-links-2__item" href="https://lisk.io/terms-conditions" class="institutional-links-2-item">Terms & Conditions</a>
                <a class="institutional-links-2__item" href="https://lisk.io/privacy" class="institutional-links-2-item">Privacy Policy</a>
            </div>
            <p class="footer__copyright-text">Lisk is a foundation registered in Zug, Switzerland
            </p>
        </div>
        <div class="footer__logo-container">
            <img src="../_/img/lisk-logo-light.svg" class="footer__lisk-logo"/>
        </div>
        <div class="community-section">
            <p class="community-section__text">Follow Lisk on: </p>
            <div class="community-section__icons">
                <a href="https://github.com/LiskHQ" target="_blank" class="footer__icon icon-github"></a>
                <a href="https://www.youtube.com/channel/UCuqpGfg_bOQ8Ja4pj811PWg/featured" target="_blank" class="footer__icon icon-youtube"></a>
                <a href="https://www.reddit.com/r/Lisk/" target="_blank" class="footer__icon icon-reddit"></a>
                <a href="https://www.linkedin.com/company/lisk/" target="_blank" class="footer__icon icon-linkedin"></a>
                <a href="https://twitter.com/LiskHQ" target="_blank" class="footer__icon icon-twitter"></a>
                <a href="https://www.facebook.com/LiskHQ" target="_blank" class="footer__icon icon-facebook"></a>
            </div>
        </div>
    </div>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/tabs-block-behaviour.js"></script>
  <script src="../_/js/vendor/docsearch.min.js"></script>
  <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
  <script>
    function focusSearchInput () { document.querySelector('#search-input').focus() }
    var search = docsearch({
        appId: 'C4SU57KGV9',
      apiKey: '55aa8709b04eb62f08f87571cf77547c',
      indexName: 'lisk-docs-search',
      inputSelector: '#search-input',
      autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
      algoliaOptions: { hitsPerPage: 10 }
    }).autocomplete
    search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
    focusSearchInput()
    window.addEventListener('load', focusSearchInput)
  </script>

  </body>
</html>
